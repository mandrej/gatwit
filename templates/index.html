{% extends "base.html" %}

{% macro render_tweet(obj, level=0) %}
    <div id="{{ obj.id }}" class="tweet" style="margin-left: {{ '%spx' % (32 * level) }}">
        <a href="https://twitter.com/{{ obj.user.screen_name }}" target="_blank">
            <img src="{{ blank }}" style="background: url({{ obj.user.profile_image_url }})">
        </a>
        <p>
            <a class="twit" href="https://twitter.com/{{ obj.user.screen_name }}" target="_blank">
                @{{ obj.user.screen_name|default }}
            </a>
            <small>
            {{ obj.user.friends_count }} friends, {{ obj.user.followers_count }} followers,
            {{ obj.retweet_count }} retweets, {{ obj.favorite_count }} favorites
            </small>
            <br>
            <span>{{ obj.text|twitterize|urlize }}</span>
            <br>
            <small>
                {{ obj.created_at|timesince }}, {{ obj.source }},
                {% if obj.coordinates %}
                    <i class="fa fa-map-marker">
                        {{ obj.coordinates|geo_address }}
                    </i>
                {% else %}
                    {{ obj.user.location }}
                {% endif %}
            </small>
        </p>
    </div>
    {% if obj.in_reply_to_status_id and level < 4 %}
        {% set level = level + 1 %}
        {% set thread = obj.in_reply_to_status_id|get_status %}
        {% if thread %}
            {{ render_tweet(thread, level) }}
        {% endif %}
    {% endif %}
{% endmacro %}

{% block content %}
    {% for obj in tweets %}
        {{ render_tweet(obj) }}
    {% else %}
        <p class="noresults">No search results</p>
    {% endfor %}
{% endblock %}